{% extends 'base.html' %}
{% block title %}마이페이지{% endblock %}
  {% load static %}
  {% block content %}
  <style type="text/css">
    a:link { color: #67594C; text-decoration: none;}
    a:visited { color: #67594C; text-decoration: none;}
    img { vertical-align: bottom; }
    .post-img { margin : 0px; }
    .todayWorryContent { 
      display : grid;
      grid-template-columns: repeat(2, 1fr);
      {% comment %} margin: 0 30px; {% endcomment %}
    }
    .todayWorryContent-left {
      margin : 0 20px;
    }
    .mypage {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 62vw;
      border-bottom: 2px solid var(--color3);
      margin-left:450px;
  
    }
    .myWorry-button-1{
      background-color: #E9E5DA;
    }
    
    .myWorry-button-2{
      background-color: #E9E5DA;
    }
    
    .myWorry-button-3 {
      background-color: #E9E5DA;
    }
    .myWorry-button-1.clicked {
      background-color: #67594C;
    }
    
    .myWorry-button-2.clicked {
      background-color: #67594C;
    }
    
    .myWorry-button-3.clicked  {
      background-color: #67594C;
    }

    .myWorry-button-text__title-1 {
      font-family: Pretendard;
      font-size: 24px;
      font-style: normal;
      font-weight: 700;
      line-height: 160%;
      margin-bottom: 4px;
      color: #67594C;
  }

    .myWorry-button-text__title-1.clicked {
      font-family: Pretendard;
      font-size: 24px;
      font-style: normal;
      font-weight: 700;
      line-height: 160%;
      margin-bottom: 4px;
      color : #E9E5DA;
    }

    .myWorry-button-text__title-2 {
      font-family: Pretendard;
      font-size: 24px;
      font-style: normal;
      font-weight: 700;
      line-height: 160%;
      margin-bottom: 4px;
      color: #67594C;
  }

    .myWorry-button-text__title-2.clicked {
      font-family: Pretendard;
      font-size: 24px;
      font-style: normal;
      font-weight: 700;
      line-height: 160%;
      margin-bottom: 4px;
      color : #E9E5DA;
    }

    .myWorry-button-text__title-3 {
      font-family: Pretendard;
      font-size: 24px;
      font-style: normal;
      font-weight: 700;
      line-height: 160%;
      margin-bottom: 4px;
      color: #67594C;
    }

    .myWorry-button-text__title-3.clicked {
      font-family: Pretendard;
      font-size: 24px;
      font-style: normal;
      font-weight: 700;
      line-height: 160%;
      margin-bottom: 4px;
      color : #E9E5DA;
    }
  </style>

        <div class="mypage">
            <div class="mypage__title">마이페이지</div>
            <div class="mypage__content">
                <div class="mypage__nicname">
                    {% comment %} 프로필 사진 {% endcomment %}
                      {% if request.user.image %}
                          <img class="card__image" src="{{ request.user.image.url }}" alt="" height="40" width="40">
                    {% comment %} 회원가입 시 이미지가 없는 경우 {% endcomment %}
                      {% else %}
                          <img class="card__image" src="{% static 'photo/basic_profile.png' %}" alt="" height="40" width="40">
                      {% endif %}
                    <span>{{ user.username }}</span>
                </div>
                <div class="mypage__settings">
                  {% comment %} 프로필 수정 부분 페이지 연결하기 {% endcomment %}
                  <a href="{% url 'accounts:logout' %}"><span>프로필 수정</span></a>
                  <a href="{% url 'accounts:logout' %}"><span>로그아웃</span></a>
                </div>    
            </div>
        </div>
        <div class="bottomline"></div>

        <form action="" method="GET" enctype="multipart/form-data">
        <div class="myWorry-buttons">
            <button class="myWorry-button-1" name ="mypage" value="mypost">
              <div class="myWorry-button">
                <div id="myWorry-btn-title" class="myWorry-button-text__title-1">나의 고민</div>
                <div class="myWorry-button-text__count-1"> </div>
              </div>
            </button>
            <button class="myWorry-button-2" name="mypage" value="myheart">
                <div class="myWorry-button">
                    <div id="myWorry-btn-title" class="myWorry-button-text__title-2">내가 공감한 고민</div>
                    <div class="myWorry-button-text__count-2"></div>
                </div>
            </button>
            <button class="myWorry-button-3" name="mypage" value="mycomment">
                <div class="myWorry-button">
                  <div id="myWorry-btn-title" class="myWorry-button-text__title-3">내가 답변한 고민</div>
                  <div class="myWorry-button-text__count-3"></div>
                </div>
            </button>
        </div>
      </form>

    <script>
      const todayWorryLeftBtn = document.querySelectorAll('.todayWorryContent-two-buttons-left');
const todayWorryRightBtn = document.querySelectorAll('.todayWorryContent-two-buttons-right');
const todayWorrySmallBtn = document.querySelectorAll('.todayWorryContent-four-buttons-choice-btn');
const myWorryBtn1 = document.querySelector('.myWorry-button-1');
const myWorryBtn2 = document.querySelector('.myWorry-button-2');
const myWorryBtn3 = document.querySelector('.myWorry-button-3');
const myWorryBtnTitle = document.querySelector('#myWorry-btn-title');
const myWorryBtnCount = document.querySelector('#myWorry-btn-count');

// 색상
const brownColor =  '#67594C';
const whiteColor = '#FAF9F6';
const lightBrownColor = '#E9E5DA';
const cgBtnOriginFontColor = 'rgba(103, 89, 76, 0.50)';
const notchosenBtnColor = '#D2CDBC';

todayWorryLeftBtn.forEach((todayWorryLeftBtn, index) => {
    let isClicked = false;
  
    todayWorryLeftBtn.addEventListener('click', function() {
      const hiddenElement = this.querySelector('.ratio');
      if (isClicked) {
        this.style.backgroundColor = whiteColor;
        this.style.color = brownColor;
        todayWorryRightBtn.style.color = brownColor;
        hiddenElement.classList.add('hidden');
      } else {
        this.style.backgroundColor = brownColor;
        this.style.color = whiteColor;
        todayWorryRightBtn.style.color = notchosenBtnColor;
        hiddenElement.classList.remove('hidden');
      }
  
      isClicked = !isClicked;
    });
});
  
todayWorryRightBtn.forEach((todayWorryRightBtn, index) => {
    let isClicked = false;
  
    todayWorryRightBtn.addEventListener('click', function() {
      const hiddenElement = this.querySelector('.ratio');
      if (isClicked) {
        this.style.backgroundColor = whiteColor;
        this.style.color = brownColor;
        todayWorryLeftBtn.style.color = brownColor;
        hiddenElement.classList.add('hidden');
      } else {
        this.style.backgroundColor = brownColor;
        this.style.color = whiteColor;
        todayWorryLeftBtn.style.color = notchosenBtnColor;
        hiddenElement.classList.remove('hidden');
      }
  
      isClicked = !isClicked;
    });
});
todayWorrySmallBtn.forEach((button, index) => {
    let isClicked = false;
    
    button.addEventListener('click', function() {
      todayWorrySmallBtn.forEach((btn, btnIndex) => {
        const hiddenElement = btn.querySelector('.ratio');
        if (btnIndex !== index) {
            if(isClicked) {
                btn.style.color = brownColor;
            }
            else {
                btn.style.color = notchosenBtnColor;
            }
        } else {
          if (isClicked) {
            btn.style.backgroundColor = whiteColor;
            btn.style.color = brownColor;
            hiddenElement.classList.add('hidden');
          } else {
            btn.style.backgroundColor = brownColor;
            btn.style.color = whiteColor;
            hiddenElement.classList.remove('hidden');
          }
        }
      });
    
      isClicked = !isClicked;
    });
});
function handleClick(clickedButton) {
  // 모든 버튼의 배경색상과 폰트색상을 초기화합니다.
  myWorryBtn1.style.backgroundColor = '';
  myWorryBtn2.style.backgroundColor = '';
  myWorryBtn3.style.backgroundColor = '';
  document.querySelector('.myWorry-button-text__title-1').style.color = '';
  document.querySelector('.myWorry-button-text__count-1').style.color = '';
  document.querySelector('.myWorry-button-text__title-2').style.color = '';
  document.querySelector('.myWorry-button-text__count-2').style.color = '';
  document.querySelector('.myWorry-button-text__title-3').style.color = '';
  document.querySelector('.myWorry-button-text__count-3').style.color = '';

  // 클릭된 버튼을 파악하고 해당 버튼의 디자인을 변경합니다.
  if (clickedButton === myWorryBtn1) {
    myWorryBtn1.style.backgroundColor = brownColor;
    myWorryBtnTitle.style.color = whiteColor;
    myWorryBtnCount.style.color = whiteColor;
  } else if (clickedButton === myWorryBtn2) {
    myWorryBtn2.style.backgroundColor = brownColor;
    document.querySelector('.myWorry-button-text__title-2').style.color = whiteColor;
    document.querySelector('.myWorry-button-text__count-2').style.color = whiteColor;
    
    myWorryBtn1.classList.add('myWorry-button-2');
    myWorryBtn1.classList.remove('myWorry-button-1');
    document.querySelector('.myWorry-button-text__title-1').style.color = brownColor;
    document.querySelector('.myWorry-button-text__count-1').style.color = 'rgba(103, 89, 76, 0.50)';
  } else if (clickedButton === myWorryBtn3) {
    myWorryBtn3.style.backgroundColor = brownColor;
    document.querySelector('.myWorry-button-text__title-3').style.color = whiteColor;
    document.querySelector('.myWorry-button-text__count-3').style.color = whiteColor;
    myWorryBtn1.classList.add('myWorry-button-2');
    myWorryBtn1.classList.remove('myWorry-button-1');
    document.querySelector('.myWorry-button-text__title-1').style.color = brownColor;
    document.querySelector('.myWorry-button-text__count-1').style.color = 'rgba(103, 89, 76, 0.50)';
  }
}

// 각 버튼에 클릭 이벤트를 추가합니다.
myWorryBtn1.addEventListener('click', function() {
  handleClick(myWorryBtn1);
});
myWorryBtn2.addEventListener('click', function() {
  handleClick(myWorryBtn2);
});
myWorryBtn3.addEventListener('click', function() {
  handleClick(myWorryBtn3);
});
    </script>

          <section class="content-section">
            <div class="todayWorryContent">
              {% for post in post_list %}
              {% if post.writer|stringformat:"s" != "gomgom"%}
                  <div class="todayWorryContent-left">
                    <div class="todayWorryContent-left-start">
                        <div class="todayWorryContent-medium-sizebox">
                            <div class="todayWorryContent-question-header">
                                <div class="todayWorryContent-question-header__title">
                                  <a href="{% url 'posts:post-detail' post.id %}">{{ post.title }}</a>
                                </div>
                                <div class="todayWorryContent-question-header__like1">
                                    <div class="todayWorryContent-question-header__like-icon">
                                      <img src="{% static 'photo/message.svg'%}" alt="message">
                                    </div>
                                    <div class="todayWorryContent-question-header__like-count">
                                      {{ post.comment_set.count }}
                                    </div>
                                </div>
                                <div class="todayWorryContent-question-header__like2">
                                    <div class="todayWorryContent-question-header__like-icon">
                                        <img class=".todayWorryContent-icon" src="{% static 'photo/heart.svg'%}" alt="heart">
                                    </div>
                                    <div class="todayWorryContent-question-header__like2-text">
                                        {{ post.like.count }}
                                    </div>
                                </div>
                            </div>
                            <div class="todayWorryContent-two-buttons">
                                <div class="todayWorryContent-two-buttons-left">
                                    <div class="todayWorryContent-two-buttons-left-1">
                                        <div>{{ post.selection_set.all.0.content }}</div>
                                        <div class="hidden ratio">60%</div>
                                    </div>
                                </div>
                                <div class="todayWorryContent-two-buttons-right">
                                    <div class="todayWorryContent-two-buttons-right-1">
                                        <div>{{ post.selection_set.all.1.content }}</div>
                                        <div class="hidden ratio">40%</div>
                                    </div>
                                </div>
                            </div>
                            <div class="todayWorryContent-left-start-box-post">
                              {{ post.content }}
                            </div>
                        </div>
          
                        <div class="todayWorryContent-profile">
                            <div class="todayWorryContent-profile-box">
                                <div class="todayWorryContent-profile-box-1">
                                    <div class="todayWorryContent-profile-box-icon">
                                      {% if post.writer.image %}
                                        <img class="userImage" src="{{ post.writer.image.url }}" alt="프로필 이미지">
                                      {% else %}
                                        <img src="{% static 'photo/mypage-icon.png' %}" alt="프로필 이미지">
                                      {% endif %}
                                    </div>
                                    <div class="todayWorryContent-profile-box-text1">
                                      {{ post.writer }}
                                    </div>
                                </div>
                                <div class="todayWorryContent-profile-box-text2">
                                  {{ post.created_string }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                  </div>
                  {% endif %}
                  {% endfor %}
          </section>
    
          <div class="pageNumberBar">
            <div class="pageNumberBar-container">
              <div class="pageNumberBar-container__left-btn">
                <img src="{% static 'photo/leftBtn.png'%}">
              </div>
              <div class="pageNumberBar-container__chosen-page">
                <img src="{% static 'photo/chosenPageSign.svg'%}">
              </div>
              <div class="pageNumberBar-container__second">
                2
              </div>
              <div class="pageNumberBar-container__third">
                3
              </div>
              <div class="pageNumberBar-container__right-btn">
                <img src="{% static 'photo/rightBtn.png'%}">
              </div>
              </div>
          </div>
        </main>
{% endblock %}